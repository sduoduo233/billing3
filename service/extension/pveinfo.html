<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PVE Info</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.8/css/bootstrap.min.css" integrity="sha512-2bBQCjcnw658Lho4nlXJcc6WkV/UxpE/sAokbXPxQNGqmNdQrWqtw26Ns9kFF/yG792pKR1Sx8/Y1Lf1XN4GKA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.13.1/font/bootstrap-icons.min.css" integrity="sha512-t7Few9xlddEmgd3oKZQahkNI4dS6l80+eGEzFQiqtyVYdvcSG2D3Iub77R20BdotfRPA9caaRkg1tyaJiPmO0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>

<div class="m-3">
    <div class="row">
        <div class="col col-md-4 col-12">
            <span class="text-muted">Status</span>
            <p>
                {{ if eq .Status "running" }}
                <span class="badge text-bg-success">Running</span>
                {{ else }}
                <span class="badge text-bg-danger">Stopped</span>
                {{ end }}
            </p>
        </div>
        <div class="col col-md-4 col-12">
            <span class="text-muted">Name</span>
            <p class="">{{ .Name }}</p>
        </div>
        <div class="col col-md-4 col-12">
            <span class="text-muted">CPU Cores</span>
            <p class="">{{ .Cores }}</p>
        </div>
        <div class="col col-md-4 col-12">
            <span class="text-muted">Disk</span>
            <p class="">{{ .MaxDisk }} GB</p>
        </div>
        <div class="col col-md-4 col-12">
            <span class="text-muted">Memory</span>
            <p class="">{{ .MaxMemory }} MB</p>
        </div>
        <div class="col col-md-4 col-12">
            <span class="text-muted">IPv4</span>
            <p class="">{{ .IPv4 }}</p>
        </div>
        <div class="col col-md-4 col-12">
            <span class="text-muted">IPv4 Gateway</span>
            <p class="">{{ .IPv4Gateway }}</p>
        </div>
        <div class="col col-md-4 col-12">
            <span class="text-muted">SSH Username</span>
            <p class="">{{ .Username }}</p>
        </div>
        <div class="col col-md-4 col-12">
            <span class="text-muted">SSH Password</span>
            <p class="">{{ .Password }}</p>
        </div>
    </div>

    <div class="mb-3">
        <button id="vnc-btn" class="btn btn-primary">
            <span class="spinner-border spinner-border-sm" aria-hidden="true" style="display: none;"></span>
            VNC
        </button>
    </div>

    
    <div class="mb-3">
        <span class="text-muted">Reinstall OS</span>
        <div class="input-group mb-3">
            <select class="form-select" id="os-select">
                <option selected></option>
                {{ range .OS }}
                <option value="{{ index . 1 }}">{{ index . 0 }}</option>
                {{ end }}
            </select>
            <button class="btn btn-primary" id="os-btn" type="button">Reinstall</button>
        </div>
    </div>
</div>

<script>
    $(function() {
        $("#vnc-btn").click(async function() {
            $("#vnc-btn .spinner-border").show();
            $("#vnc-btn").attr("disabled", true);
            try {
                const resp = await fetch(location.href, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ action: "vnc" })
                })
                const data = await resp.json();
                if (data.ok) {
                    window.open("/api/extension/pve/novnc?jwt=" + encodeURIComponent(data.jwt), "_blank");
                } else {
                    console.error(data);
                    if (data.error) {
                        alert("Error: " + data.error);
                    } else {
                        alert("Something went wrong. Please check server log.");
                    }
                }
            } catch (error) {
                console.error(error);
                alert("Something went wrong. Please check server log.");
            } finally {
                $("#vnc-btn .spinner-border").hide();
                $("#vnc-btn").attr("disabled", false);
            }
        })
        $("#os-btn").click(function() {
            var selectedOs = $("#os-select").val();
            if (!confirm("Are you sure you want to reinstall " + $("#os-select option:selected").text() + "? This will erase all data on the server.")) {
                return;
            }
            fetch(location.href, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ action: "reinstall", os: selectedOs })
            }).then(response => {
                return response.json();
            }).then(data => {
                if (data.ok) {
                    alert("Reinstallation started successfully.");
                    window.parent.location.reload();
                } else {
                    console.error(data);
                    if (data.error) {
                        alert("Error: " + data.error);
                    } else {
                        alert("Something went wrong. Please check server log.");
                    }
                }
            }).catch(error => {
                console.error(error);
                alert("Something went wrong. Please check server log.");
            });
        });
    });
</script>

</body>

</html>